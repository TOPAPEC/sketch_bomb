# Интеллектуальный ассистент для художников: превращение набросков в реалистичные изображения с помощью ControlNet и текстовых подсказок

Номер темы 90
Уровень темы pro 

Команда: 
@TOPAPEC (Данил Бугриенко)
Руководитель: 
@jdbelg (Глеб Булыгин)

## Общий план проекта 
Грубыми мазками делаем 2 LORA адаптера:
1. Из грубого скетча в детальный скетч
2. Из детального скетча в фильнальное изображение

### Детали первой стадии
Есть большие вопросы как тренировать image to image диффузию, учитывая, что мы тренируем скорее всего Stable Diffusion XL.
IP адаптер мы натренировать вряд ли сможем, поэтому пока есть вариант обычной текст в скетч лоры и далее в первые шаги гайдим контролнетом и последние шаги отдаем на откуп модели, либо 
модель, которая через clip или другой энкодер по картинке предсказывает промпт и далее по промпту генерируем через нашу лору готовый скетч.

### Детали второй стадии
Тут более понятная задача - по детальному скетчу мы гайдим почти до самого конца модель через контролнет и в конце даем ей потворить несколько шагов.

### Детали датасета
Первый датасет, который собираем - 2д арт с одним объектом в кадре (+ теги). Источники для начала - danbooru (будет bias в аниме стиль).
Скорее всего будет общий большой датасет и датасет с отобранными и самыми приятными стилями.
Автоматический отбор качественных изображений будем делать по перцентилю PickScore. 

### Аугментации
На картинках центрируем объект и снимаем lineart скетч. Храним и оригинал и скетч.
Далее скетч искажаем и упрощаем алгоритмически там, чтобы он больше был похож на человеческий скетч. 
Возможно попробуем упрощать скетчи через преждевременное завершение генерации через контролнет (15 шагов вместо 30 по скетчу и далее снова выделение скетча). 

### Финальный интерфейс
Пока целевой интерфейс - сайт. На вход от пользователя скетч без текстовых подсказок (рисуется прямо пальцем или мышкой на сайте), на выход - готовая картинка. 

## План 
1. Созвонились-познакомились
2. Собираем датасет пар скетчей и картинок с тегами. Смотрим на среднее качество данных без ручного отбора. Пробуем набрать эталонных стилей для формирования уникального стиля модели. Пробуем методы упрощения детального скетча.
3. Первая лора из грубого скетча в детальный на наших датасетах и возможная корректировка подхода.
4. Дальше будем смотреть на результаты третьего шага, так как он самый неопределенный в проекте и будем корректировать план
5. Продолжение следует
6. Продолжение следует
7. Продолжение следует
